# WebDVCS

A distributed version control system that works both in the browser and command line, using SQLite for storage and Git-like workflows.

## Features

- **CLI and Web Interface**: Use from command line or browser
- **SQLite Storage**: Each repository is a single `.sqlite` file
- **Git-like Commands**: Standard `add`, `commit`, `branch`, `merge` workflow
- **Browser VCS**: Full version control in any modern web browser
- **Content Deduplication**: Shared files stored once
- **Delta Compression**: Efficient storage using librsync algorithms
- **Branch Operations**: Create, switch, merge, and export branches
- **Cross-Platform**: Runs on Windows, macOS, and Linux

## Quick Start

### CLI Usage

```bash
# Initialize a repository
node webdvcs.js init myproject

# Add files and commit
node webdvcs.js myproject add README.md
node webdvcs.js myproject commit "Initial commit"

# View status and history
node webdvcs.js myproject status
node webdvcs.js myproject log

# Branch operations
node webdvcs.js myproject branch feature
node webdvcs.js myproject switch feature
node webdvcs.js myproject merge main
```

### Web Interface

Open the web interface to:
- Create and manage repositories
- Upload and stage files
- View commit history
- Work with branches
- Export/import repositories

**Usage:** `npm run build && npm run serve:dist` then go to `http://localhost:8080`

## Installation

### For CLI Use
```bash
git clone https://github.com/ricardodeazambuja/webdvcs.git
cd webdvcs
npm install
```

### For Web Use
1. Clone the repository
2. Run `npm install`
3. Run `npm run build` (development) or `npm run build:github` (production)
4. Run `npm run serve:dist` to start a local server
5. Open `http://localhost:8080` in your browser

## Project Structure

- **CLI**: `webdvcs.js` - Command-line interface
- **Core Library**: `lib/core/` - Repository, storage, and VCS logic
- **Browser Interface**: `dist/` - Built web GUI (generated by build process)
- **Tests**: `tests/` - Comprehensive test suite (11 modules, 6 browser tests)

## Commands Reference

| Command | Description |
|---------|-------------|
| `init <repo>` | Create or load repository |
| `add <path>` | Stage file or directory |
| `commit <message>` | Create commit |
| `status` | Show repository status |
| `log [count]` | View commit history |
| `branch [name]` | List or create branches |
| `switch <branch>` | Switch to branch |
| `merge <branch>` | Merge branch |
| `checkout <hash> [file]` | Checkout commit or file |
| `diff <file1> <file2>` | Compare files |
| `export <branch>` | Export branch to file |
| `import <file>` | Import branch from file |

Run `node webdvcs.js help` for complete command reference.

## Architecture

- **Storage**: SQLite database with content-addressed objects
- **Compression**: Delta compression for efficient storage
- **Deduplication**: Automatic file content deduplication
- **Browser Support**: WebAssembly SQLite via sql.js
- **Concurrency**: Web Workers for non-blocking operations

## Development

### Running Tests
```bash
npm test              # Core library tests (11 modules)
npm run test:browser  # Browser interface tests (6 tests)
npm run test:all      # All tests
```

### Building
```bash
npm run build         # Development build
npm run build:prod    # Production build
npm run build:github  # GitHub Pages build
```

### Local Development
```bash
npm run serve         # Start local server from root (for development)
npm run serve:dist    # Start local server from dist/ (production-like)
npm run ci            # Full CI pipeline simulation
```

## Requirements

- Node.js v20+
- Modern browser with WebAssembly support
- SQLite (via better-sqlite3 or sql.js)

## Implementation

- Storage: SQLite with custom schema for VCS objects
- Compression: Delta algorithms inspired by librsync
- Deduplication: Content-addressed storage
- Browser: sql.js with Web Workers for performance

## License

ISC License - see package.json for details.

## Contributing

1. Fork the repo
2. Create a feature branch
3. Make your changes
4. Run `npm run ci` to test
5. Submit a pull request

Tests must pass before merging.